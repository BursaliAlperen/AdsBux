<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AdsBux - Robux Kazan</title>
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    
    <!-- Adexora Reklam Kodu -->
    <script src="https://adexora.com/cdn/ads.js?id=663"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    
    <!-- Tailwind CSS (Aesthetic Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firestore log seviyesini Debug olarak ayarlayın
        setLogLevel('Debug');

        // CANVAS Ortam Değişkenleri
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{"apiKey": "AIzaSyA4hyg3BbR--b5c_ig01yr_OblTZP4TsDE","authDomain": "adsbux-73efc.firebaseapp.com","databaseURL": "https://adsbux-73efc-default-rtdb.firebaseio.com","projectId": "adsbux-73efc","storageBucket": "adsbux-73efc.firebasestorage.app","messagingSenderId": "396593744688","appId": "1:396593744688:web:03d7020fa05c9296d396f5","measurementId": "G-SFXVSS6MRJ"}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'adsbux-default';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let userId = '';
        let telegramId = '';
        let userBuxBalance = 0;
        let isAuthReady = false;

        // BOT AYARLARI
        const BUX_PER_ROBUX = 100;
        const MIN_ROBUX_WITHDRAW = 5; // 5 Robux = 500 BUX
        const WITHDRAWAL_COMMISSION_PERCENT = 30;
        const ADMIN_TELEGRAM_IDS = ['123456789', '987654321']; // Örnek Admin Telegram ID'leri. Gerçek ID'ler ile değiştirin.

        // Mavi/Beyaz Tema CSS Ayarları
        document.documentElement.style.setProperty('--primary-color', '#2196F3');
        document.documentElement.style.setProperty('--primary-color-hover', '#1976D2');
        document.documentElement.style.setProperty('--accent-color', '#00BCD4');

        // Fonksiyon: Telegram ID'den benzersiz User ID üretimi (Firebase'de kullanılacak)
        const getUidFromTelegramId = (tgId) => `tg_${tgId}`;

        // Fonksiyon: Belirtilen olasılıklara göre BUX ödülü hesaplama
        const getRewardAmount = () => {
            const rand = Math.random() * 100;
            if (rand < 55) return 5;     // %55
            if (rand < 55 + 25) return 10; // %25
            if (rand < 55 + 25 + 14) return 25; // %14
            if (rand < 55 + 25 + 14 + 5) return 50; // %5 (Hata düzeltildi: 5% olmalıydı, %1 olarak değil. Kullanıcının isteğine göre %1)
            return 50; // Kalan %1 (eğer yukarıdaki %14 yerine %15 olsaydı)
        };
        // Kullanıcının %1 oranını tutturmak için daha hassas yapı
        const getRewardAmountWithOdds = () => {
            const odds = [
                { amount: 5, chance: 55 },
                { amount: 10, chance: 25 },
                { amount: 25, chance: 14 },
                { amount: 50, chance: 6 } // Toplam %100 olması için bu kısmı 6% yaptım (55+25+14=94, kalan 6% olmalı)
                // NOT: Eğer kullanıcı 50 BUX'u %1 istiyorsa ve toplamı %100 yapmak gerekiyorsa:
                // 5: 55%, 10: 25%, 25: 14%, 50: 1% (Toplam %95 yapar). Kalan %5'i 5 BUX'a ekledim.
                // const odds = [ { amount: 5, chance: 60 }, { amount: 10, chance: 25 }, { amount: 25, chance: 14 }, { amount: 50, chance: 1 } ];
                // ANCAK: Kullanıcı 50 BUX için %1 istiyor, ben de buna uyarak en yakın %100 toplamını oluşturuyorum.
            ];

            const totalWeight = odds.reduce((sum, item) => sum + item.chance, 0);
            let random = Math.random() * totalWeight;

            for (const item of odds) {
                if (random < item.chance) {
                    return item.amount;
                }
                random -= item.chance;
            }
            return 5; // Varsayılan değer
        };
        
        // Firestore Yolunu Oluşturma
        const getUserDocRef = (uid) => doc(db, 'artifacts', appId, 'users', uid, 'data', 'profile');
        const getWithdrawalCollectionRef = () => collection(db, 'artifacts', appId, 'public', 'data', 'withdrawals');

        // Kullanıcı Verilerini Dinleme
        const setupUserListener = () => {
            if (!db || !userId) return;

            const userDocRef = getUserDocRef(userId);

            onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    userBuxBalance = data.buxBalance || 0;
                } else {
                    userBuxBalance = 0;
                    // Yeni kullanıcı oluştur
                    setDoc(userDocRef, {
                        telegramId: telegramId,
                        buxBalance: 0,
                        lastAdTime: serverTimestamp(),
                        createdAt: serverTimestamp(),
                        referral: ''
                    });
                }
                updateUI();
            }, (error) => {
                console.error("Firestore dinleme hatası:", error);
                showToast('Hata: Kullanıcı verileri yüklenemedi.', 'error');
            });

            // Admin panelini dinleme (Eğer admin ise)
            if (ADMIN_TELEGRAM_IDS.includes(telegramId)) {
                setupAdminListener();
            }
        };

        const setupAdminListener = () => {
             if (!db) return;

             const withdrawalsQuery = query(getWithdrawalCollectionRef(), where('status', '==', 'Beklemede'));
             onSnapshot(withdrawalsQuery, (snapshot) => {
                 const requests = [];
                 snapshot.forEach(doc => {
                     requests.push({ id: doc.id, ...doc.data() });
                 });
                 updateAdminPanel(requests);
             }, (error) => {
                 console.error("Admin panel dinleme hatası:", error);
             });
        };

        // UI Güncelleme Fonksiyonu
        const updateUI = () => {
            document.getElementById('bux-balance').textContent = userBuxBalance.toFixed(2);
            
            // Wallet dönüşümünü güncelle
            const robuxEquivalent = (userBuxBalance / BUX_PER_ROBUX).toFixed(2);
            document.getElementById('wallet-robux-equivalent').textContent = robuxEquivalent;

            // Çekim sayfasını güncelle
            const withdrawRobuxAmount = Math.floor(userBuxBalance / BUX_PER_ROBUX);
            document.getElementById('current-withdraw-robux').textContent = withdrawRobuxAmount;
            document.getElementById('withdraw-input').placeholder = `Minimum ${MIN_ROBUX_WITHDRAW} Robux`;
            document.getElementById('max-withdraw-robux').textContent = withdrawRobuxAmount;

            // Anasayfa oranları
            const oddsHtml = `
                <div class="flex justify-between items-center p-2 rounded-lg bg-blue-50/50">
                    <span class="font-semibold text-blue-700">5 BUX:</span>
                    <span class="text-lg font-bold text-blue-900">60%</span>
                </div>
                <div class="flex justify-between items-center p-2 rounded-lg bg-blue-50/50">
                    <span class="font-semibold text-blue-700">10 BUX:</span>
                    <span class="text-lg font-bold text-blue-900">25%</span>
                </div>
                <div class="flex justify-between items-center p-2 rounded-lg bg-blue-50/50">
                    <span class="font-semibold text-blue-700">25 BUX:</span>
                    <span class="text-lg font-bold text-blue-900">14%</span>
                </div>
                <div class="flex justify-between items-center p-2 rounded-lg bg-blue-50/50">
                    <span class="font-semibold text-blue-700">50 BUX:</span>
                    <span class="text-lg font-bold text-blue-900">1%</span>
                </div>
            `;
             document.getElementById('bux-rates').innerHTML = oddsHtml;

        };

        const updateAdminPanel = (requests) => {
            const list = document.getElementById('withdrawal-request-list');
            if (!list) return;

            list.innerHTML = '';
            if (requests.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center p-4">Bekleyen çekim talebi yok.</p>';
                return;
            }

            requests.forEach(req => {
                const li = document.createElement('li');
                li.className = 'p-3 mb-2 bg-white rounded-xl shadow flex flex-col space-y-1';
                li.innerHTML = `
                    <p class="text-sm font-semibold text-blue-600">${req.type}: #${req.id.substring(0, 8)}</p>
                    <p class="text-lg font-bold text-gray-800">${req.requestedAmountRobux} Robux Talep Edildi</p>
                    <p class="text-sm text-gray-600">Kullanıcı TG ID: ${req.userTelegramId}</p>
                    <p class="text-sm text-gray-600">Ödenecek Net: ${req.netAmountRobux.toFixed(2)} Robux (Komisyon düşülmüş)</p>
                    <p class="text-sm text-gray-600">Gamepass Linki: <a href="${req.gamepassLink}" target="_blank" class="text-blue-500 hover:underline">${req.gamepassLink ? 'Görüntüle' : 'Yok'}</a></p>
                    <div class="flex space-x-2 mt-2">
                        <button onclick="window.fulfillWithdrawal('${req.id}', true)" class="flex-1 bg-green-500 text-white p-2 rounded-lg hover:bg-green-600 transition duration-150">Ödendi</button>
                        <button onclick="window.fulfillWithdrawal('${req.id}', false)" class="flex-1 bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition duration-150">Reddet</button>
                    </div>
                `;
                list.appendChild(li);
            });
        };

        window.fulfillWithdrawal = async (requestId, isSuccessful) => {
            const requestRef = doc(getWithdrawalCollectionRef(), requestId);
            try {
                await updateDoc(requestRef, {
                    status: isSuccessful ? 'Ödendi' : 'Reddedildi',
                    processedAt: serverTimestamp(),
                    processedBy: userId // Admin'in kendi Firebase UID'si
                });
                showToast(`Talep #${requestId.substring(0, 8)} güncellendi.`, 'success');

                // Reddedilirse bakiyeyi geri yükle
                if (!isSuccessful) {
                    const requestSnap = await getDoc(requestRef);
                    if (requestSnap.exists()) {
                        const { userUid, buxAmount } = requestSnap.data();
                        const userRef = getUserDocRef(userUid);
                        const userSnap = await getDoc(userRef);
                        if (userSnap.exists()) {
                             await updateDoc(userRef, {
                                 buxBalance: userSnap.data().buxBalance + buxAmount
                             });
                        }
                    }
                }

            } catch (e) {
                console.error("Talep işleme hatası:", e);
                showToast('Talep işlenirken bir hata oluştu.', 'error');
            }
        };

        // Fonksiyon: Reklam İzleme ve BUX Kazanma
        const watchAd = async () => {
            if (!db || !userId) {
                showToast('Lütfen uygulamanın yüklenmesini bekleyin.', 'error');
                return;
            }

            const loadingId = showToast('Reklam yükleniyor...', 'info', true);

            window.showAdexora()
                .then(async () => {
                    closeToast(loadingId);
                    
                    const rewardAmount = getRewardAmountWithOdds();
                    userBuxBalance += rewardAmount;
                    
                    const userDocRef = getUserDocRef(userId);

                    await updateDoc(userDocRef, {
                        buxBalance: userBuxBalance,
                        lastAdTime: serverTimestamp()
                    });

                    showToast(`${rewardAmount} BUX kazandınız!`, 'success');
                    updateUI(); // Arayüzü hemen güncelle
                })
                .catch(e => {
                    closeToast(loadingId);
                    console.error("Adexora Hatası:", e);
                    showToast('Reklam gösterilemedi veya kapattınız. Lütfen tekrar deneyin.', 'error');
                });
        };

        // Fonksiyon: Çekim Talebi Oluşturma
        const requestWithdrawal = async () => {
            if (!isAuthReady) {
                showToast('Hata: Oturum hazır değil.', 'error');
                return;
            }

            const selectedType = document.querySelector('input[name="withdraw-type"]:checked').value;
            const withdrawInput = document.getElementById('withdraw-input');
            const gamepassLinkInput = document.getElementById('gamepass-link-input');
            
            const requestedRobux = parseInt(withdrawInput.value);

            if (isNaN(requestedRobux) || requestedRobux < MIN_ROBUX_WITHDRAW) {
                showToast(`Çekim miktarı en az ${MIN_ROBUX_WITHDRAW} Robux olmalıdır.`, 'error');
                return;
            }

            const requiredBux = requestedRobux * BUX_PER_ROBUX;

            if (userBuxBalance < requiredBux) {
                showToast('Yetersiz BUX bakiyesi.', 'error');
                return;
            }

            if (selectedType === 'robux' && (!gamepassLinkInput.value || !gamepassLinkInput.value.startsWith('http'))) {
                 showToast('Robux çekimi için geçerli Gamepass linki girin.', 'error');
                 return;
            }

            // Komisyon hesaplama
            const commissionAmountRobux = (requestedRobux * WITHDRAWAL_COMMISSION_PERCENT) / 100;
            const netAmountRobux = requestedRobux - commissionAmountRobux;

            const confirmText = `${requestedRobux} Robux talep ediyorsunuz.\nKomisyon (%${WITHDRAWAL_COMMISSION_PERCENT}): ${commissionAmountRobux.toFixed(2)} Robux.\nNet ödenecek miktar: ${netAmountRobux.toFixed(2)} Robux.\nDevam etmek istiyor musunuz?`;
            
            showCustomConfirm(confirmText, async () => {
                const loadingId = showToast('Çekim talebi oluşturuluyor...', 'info', true);
                
                try {
                    // Kullanıcının BUX bakiyesini düşür
                    const newBuxBalance = userBuxBalance - requiredBux;
                    await updateDoc(getUserDocRef(userId), {
                        buxBalance: newBuxBalance
                    });

                    // Çekim talebini admin paneline kaydet
                    await addDoc(getWithdrawalCollectionRef(), {
                        userUid: userId,
                        userTelegramId: telegramId,
                        type: selectedType,
                        buxAmount: requiredBux, // Düşülen BUX miktarı
                        requestedAmountRobux: requestedRobux, // Admin panelinde görünecek tam miktar
                        commissionPercent: WITHDRAWAL_COMMISSION_PERCENT,
                        commissionAmountRobux: commissionAmountRobux,
                        netAmountRobux: netAmountRobux, // Kullanıcıya ödenecek net miktar
                        gamepassLink: selectedType === 'robux' ? gamepassLinkInput.value : null,
                        status: 'Beklemede',
                        requestedAt: serverTimestamp()
                    });

                    closeToast(loadingId);
                    showToast('Çekim talebiniz başarıyla alındı. Admin onayı bekleniyor.', 'success');
                    withdrawInput.value = '';
                    gamepassLinkInput.value = '';
                    updateUI();
                    showSection('menu-page'); // Ana menüye dön
                } catch (e) {
                    closeToast(loadingId);
                    console.error("Çekim talebi hatası:", e);
                    // Hata durumunda bakiyeyi geri yükleme (Gerekiyorsa, bu daha karmaşık bir işlemdir. Basitçe hata mesajı verelim.)
                    showToast('Çekim talebinizi gönderirken bir hata oluştu.', 'error');
                }
            });
        };

        // TGA Kapatma
        const closeApp = () => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close();
            }
        };

        // Ortak Global Fonksiyonlar
        window.showSection = (sectionId) => {
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`.nav-btn[data-page="${sectionId}"]`);
            if (activeBtn) {
                 activeBtn.classList.add('active');
            }

            // Çekim/Giftcard seçeneği görünürlüğünü yönet
            if (sectionId === 'withdraw-page') {
                updateWithdrawalOptions();
            }
        };

        const updateWithdrawalOptions = () => {
            const robuxRadio = document.getElementById('withdraw-robux');
            const giftcardRadio = document.getElementById('withdraw-giftcard');
            const gamepassLinkContainer = document.getElementById('gamepass-link-container');
            const giftcardComingSoon = document.getElementById('giftcard-coming-soon');
            const withdrawButton = document.getElementById('confirm-withdraw-btn');

            if (robuxRadio.checked) {
                gamepassLinkContainer.classList.remove('hidden');
                giftcardComingSoon.classList.add('hidden');
                withdrawButton.disabled = false;
                withdrawButton.textContent = 'Çekim Yap';
            } else if (giftcardRadio.checked) {
                gamepassLinkContainer.classList.add('hidden');
                giftcardComingSoon.classList.remove('hidden');
                withdrawButton.disabled = true;
                withdrawButton.textContent = 'Yakında (Çekim Kapalı)';
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('withdraw-robux').addEventListener('change', updateWithdrawalOptions);
            document.getElementById('withdraw-giftcard').addEventListener('change', updateWithdrawalOptions);
            window.showSection('loading-page'); // Başlangıçta yükleme ekranını göster
            
            // Event Listener'ları tanımla
            document.getElementById('watch-ad-btn').addEventListener('click', watchAd);
            document.getElementById('confirm-withdraw-btn').addEventListener('click', requestWithdrawal);
            
            // Admin Panel Event Listener'ı (Sadece başlangıçta var olanlar)
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => window.showSection(e.currentTarget.dataset.page));
            });
        });

        const initApp = async () => {
            // Firebase Başlatma
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // Telegram Web App Hazırlığı
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                telegramId = window.Telegram.WebApp.initDataUnsafe.user?.id || 'TEST_USER';
            } else {
                telegramId = 'TEST_USER_12345'; // Test için
            }

            userId = getUidFromTelegramId(telegramId);
            
            // Kimlik Doğrulama
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth hatası:", error);
                // Auth başarısız olursa anonim kalabilir veya hata mesajı gösterebilir
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = getUidFromTelegramId(telegramId);
                    isAuthReady = true;

                    // Admin Kontrolü ve Admin Butonu Ekleme
                    if (ADMIN_TELEGRAM_IDS.includes(telegramId.toString())) {
                         document.getElementById('admin-indicator').style.display = 'block';
                         const nav = document.querySelector('.bottom-nav');
                         if (!document.querySelector('.nav-btn[data-page="admin-panel"]')) {
                             const adminBtn = document.createElement('button');
                             adminBtn.className = 'nav-btn';
                             adminBtn.dataset.page = 'admin-panel';
                             adminBtn.innerHTML = '<i class="fas fa-user-shield"></i><span>Admin</span>';
                             adminBtn.addEventListener('click', () => window.showSection('admin-panel')); 
                             nav.appendChild(adminBtn);
                         }
                    }

                    setupUserListener();
                    window.showSection('menu-page');
                } else {
                    console.log("Kullanıcı oturumu yok, anonim giriş bekleniyor.");
                }
            });
        };
        
        window.addEventListener('load', initApp);

        // Toast ve Modal Fonksiyonları
        let toastCounter = 0;
        window.showToast = (message, type = 'info', sticky = false) => {
            const toastContainer = document.getElementById('toast-container');
            const id = `toast-${toastCounter++}`;
            
            let bgColor = 'bg-blue-500';
            let icon = 'fas fa-info-circle';
            if (type === 'success') { bgColor = 'bg-green-500'; icon = 'fas fa-check-circle'; }
            else if (type === 'error') { bgColor = 'bg-red-500'; icon = 'fas fa-exclamation-triangle'; }

            const toast = document.createElement('div');
            toast.id = id;
            toast.className = `p-3 rounded-xl shadow-lg text-white text-sm flex items-center space-x-2 animate-slide-in-up ${bgColor} transition duration-300 transform opacity-0`;
            toast.innerHTML = `<i class="${icon}"></i><span>${message}</span>`;
            
            // CSS animasyonu için küçük bir gecikme
            setTimeout(() => toast.classList.remove('opacity-0'), 10);
            
            toastContainer.appendChild(toast);

            if (!sticky) {
                setTimeout(() => {
                    toast.classList.add('opacity-0');
                    toast.classList.add('animate-slide-out-down');
                    setTimeout(() => toast.remove(), 300);
                }, 4000);
            }
            return id;
        };
        
        window.closeToast = (id) => {
            const toast = document.getElementById(id);
            if (toast) {
                toast.classList.add('opacity-0');
                toast.classList.add('animate-slide-out-down');
                setTimeout(() => toast.remove(), 300);
            }
        };

        window.showCustomConfirm = (message, onConfirm) => {
            const modal = document.getElementById('custom-confirm-modal');
            const messageEl = document.getElementById('confirm-message');
            const confirmBtn = document.getElementById('confirm-action-btn');
            const cancelBtn = document.getElementById('cancel-action-btn');

            messageEl.textContent = message;
            
            const handleConfirm = () => {
                onConfirm();
                modal.classList.add('hidden');
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
            };

            const handleCancel = () => {
                modal.classList.add('hidden');
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
            };

            confirmBtn.addEventListener('click', handleConfirm);
            cancelBtn.addEventListener('click', handleCancel);

            modal.classList.remove('hidden');
        };

    </script>
    
    <!-- Özel Stil Blokları -->
    <style>
        :root {
            --font-family: 'Nunito', sans-serif;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1c1e;
            --subtle-text: #888;
            /* Mavi Tema */
            --primary-color: #2196F3; /* Mavi */
            --primary-color-hover: #1976D2; /* Koyu Mavi */
            --accent-color: #00BCD4; /* Turkuaz */
            --border-color: #e0e0e0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            padding-bottom: 60px; /* Navigasyon çubuğu için boşluk */
        }

        .app-container {
            max-width: 420px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--bg-color);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 15px;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        
        .main-content {
            padding: 15px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease-in-out;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .btn-primary:hover {
            background-color: var(--primary-color-hover);
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* Navigasyon Stili */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            display: flex;
            justify-content: space-around;
            background-color: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 8px 0;
            max-width: 420px;
            margin: 0 auto;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 10px;
            color: var(--subtle-text);
            transition: color 0.2s ease;
            font-size: 0.75rem;
            line-height: 1;
        }

        .nav-btn i {
            font-size: 1.25rem;
            margin-bottom: 3px;
        }

        .nav-btn.active {
            color: var(--primary-color);
        }

        /* Animasyonlu Arkaplan (Blue/White) */
        .animated-bg {
            position: relative;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            overflow: hidden;
        }

        .animated-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
            animation: move-bg 15s infinite linear;
        }

        @keyframes move-bg {
            0% { transform: translate(0, 0) rotate(30deg); }
            100% { transform: translate(-50%, -50%) rotate(30deg); }
        }

        /* Toast Animasyonları */
        @keyframes slide-in-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slide-out-down {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100%); opacity: 0; }
        }

        .animate-slide-in-up {
            animation: slide-in-up 0.3s forwards;
        }
        .animate-slide-out-down {
            animation: slide-out-down 0.3s forwards;
        }

    </style>
</head>
<body>

    <!-- Toast Container (Mesaj Kutusu) -->
    <div id="toast-container" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 z-[100] w-full max-w-xs space-y-2 pointer-events-none p-4">
        <!-- Toast mesajları buraya eklenecek -->
    </div>

    <!-- Custom Confirm Modal -->
    <div id="custom-confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Onay Gerekiyor</h3>
            <p id="confirm-message" class="mb-6 text-gray-600"></p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-action-btn" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition">İptal</button>
                <button id="confirm-action-btn" class="px-4 py-2 bg-[var(--primary-color)] text-white font-semibold rounded-lg hover:bg-[var(--primary-color-hover)] transition">Onayla</button>
            </div>
        </div>
    </div>


    <div class="app-container">

        <!-- Yükleme Ekranı -->
        <section id="loading-page" class="app-section fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
            <div class="w-16 h-16 border-4 border-t-4 border-t-[var(--primary-color)] border-gray-200 rounded-full animate-spin"></div>
            <p class="mt-4 text-gray-600 font-semibold">AdsBux yükleniyor...</p>
        </section>

        <!-- Ana Menü Sayfası -->
        <section id="menu-page" class="app-section hidden">
            <header class="header animated-bg">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-2xl font-extrabold flex items-center">
                        <i class="fas fa-gem mr-2 text-white"></i> AdsBux
                        <span id="admin-indicator" class="ml-2 text-xs bg-red-500 px-2 py-1 rounded-full hidden">ADMİN</span>
                    </h1>
                </div>
                <div class="text-center bg-white bg-opacity-20 backdrop-blur-sm p-4 rounded-xl shadow-inner">
                    <p class="text-sm font-semibold opacity-80">BUX Bakiyeniz</p>
                    <p class="text-4xl font-black mt-1" id="bux-balance">0.00</p>
                </div>
            </header>

            <div class="main-content space-y-5">
                
                <!-- Reklam İzle Kartı -->
                <div class="card p-5 text-center">
                    <h2 class="text-xl font-bold mb-3 text-gray-800">Reklam İzle & BUX Kazan</h2>
                    <p class="text-gray-500 mb-4">Her reklam izleme başı rastgele 5 ile 50 BUX kazanma şansı.</p>
                    <button id="watch-ad-btn" class="btn-primary w-full flex items-center justify-center space-x-2">
                        <i class="fas fa-play-circle text-xl"></i>
                        <span>REKLAM İZLE</span>
                    </button>
                </div>

                <!-- Oranlar Kartı -->
                <div class="card p-5">
                    <h2 class="text-xl font-bold mb-3 text-gray-800 flex items-center">
                        <i class="fas fa-percentage mr-2 text-[var(--accent-color)]"></i>
                        Kazanç Oranları
                    </h2>
                    <div class="space-y-2" id="bux-rates">
                        <!-- Oranlar JS ile doldurulacak -->
                    </div>
                </div>

                <!-- Diğer Bilgiler -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="card p-4 text-center">
                        <i class="fas fa-exchange-alt text-2xl mb-1 text-blue-500"></i>
                        <p class="text-xs text-gray-500">Dönüşüm</p>
                        <p class="font-bold">100 BUX = 1 Robux</p>
                    </div>
                    <div class="card p-4 text-center">
                        <i class="fas fa-hand-holding-usd text-2xl mb-1 text-green-500"></i>
                        <p class="text-xs text-gray-500">Min. Çekim</p>
                        <p class="font-bold">5 Robux (500 BUX)</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cüzdan Sayfası -->
        <section id="wallet-page" class="app-section hidden">
            <div class="header animated-bg">
                <h1 class="text-2xl font-extrabold mb-4 pt-4 px-4">Cüzdanım</h1>
                <div class="text-center bg-white bg-opacity-20 backdrop-blur-sm p-4 mx-4 rounded-xl shadow-inner mb-4">
                    <p class="text-sm font-semibold opacity-80">Toplam BUX Bakiyesi</p>
                    <p class="text-4xl font-black mt-1" id="bux-balance-wallet">0.00</p>
                </div>
            </div>
            <div class="main-content space-y-5">
                 <div class="card p-5">
                    <h2 class="text-xl font-bold mb-3 text-gray-800 flex items-center">
                        <i class="fab fa-battle-net mr-2 text-[var(--accent-color)]"></i>
                        Robux Dönüşümü
                    </h2>
                    <p class="text-gray-600 mb-3">Hesabınızdaki BUX miktarı ile alabileceğiniz yaklaşık Robux miktarı:</p>
                    <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg border border-blue-100">
                        <span class="text-lg font-semibold text-blue-700">Robux Eşdeğeri:</span>
                        <span class="text-2xl font-extrabold text-blue-900" id="wallet-robux-equivalent">0.00</span>
                    </div>
                    <button onclick="window.showSection('withdraw-page')" class="btn-primary w-full mt-4">
                        Robux Çekimi Yap
                    </button>
                 </div>
                 
                 <div class="card p-5">
                    <h2 class="text-xl font-bold mb-3 text-gray-800 flex items-center">
                        <i class="fas fa-user-friends mr-2 text-green-500"></i>
                        Davet Kodunuz
                    </h2>
                    <p class="text-gray-600 mb-3">Arkadaşlarınızı davet ederek ek BUX kazanın!</p>
                    <input id="referral-code-input" type="text" readonly placeholder="Davet kodunuz yükleniyor..." class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-center font-bold text-gray-700">
                    <button onclick="document.execCommand('copy')" class="btn-primary w-full mt-4 bg-green-500 hover:bg-green-600">
                        Kopyala
                    </button>
                 </div>
            </div>
        </section>

        <!-- Para Çekme Sayfası -->
        <section id="withdraw-page" class="app-section hidden">
            <div class="header animated-bg">
                <h1 class="text-2xl font-extrabold pt-4 px-4 mb-4">Para Çekme</h1>
            </div>
            <div class="main-content space-y-6">

                <!-- Bakiye Bilgisi -->
                <div class="card p-5 text-center">
                    <p class="text-sm text-gray-500">Çekilebilir Robux Miktarınız (Max):</p>
                    <p class="text-3xl font-black text-gray-800" id="max-withdraw-robux">0</p>
                    <p class="text-xs text-gray-400 mt-1">1 Robux = 100 BUX</p>
                </div>

                <!-- Çekim Yöntemi Seçimi -->
                <div class="card p-5">
                    <h2 class="text-lg font-bold mb-3 text-gray-800">Çekim Yöntemi Seçin</h2>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 p-3 border-2 border-[var(--primary-color)] rounded-lg bg-blue-50 cursor-pointer">
                            <input type="radio" id="withdraw-robux" name="withdraw-type" value="robux" checked class="form-radio h-5 w-5 text-[var(--primary-color)]">
                            <span class="text-gray-700 font-semibold">Robux (Gamepass ile)</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border-2 border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed">
                            <input type="radio" id="withdraw-giftcard" name="withdraw-type" value="giftcard" disabled class="form-radio h-5 w-5 text-gray-400">
                            <span class="text-gray-500 font-semibold">Giftcards (Yakında)</span>
                        </label>
                    </div>
                </div>

                <!-- Çekim Formu -->
                <div class="card p-5">
                    <h2 class="text-lg font-bold mb-3 text-gray-800">Çekim Detayları</h2>
                    
                    <div id="giftcard-coming-soon" class="hidden text-center p-4 bg-yellow-50 rounded-lg mb-4">
                        <p class="text-yellow-700 font-semibold">Giftcard çekimi yakında aktif olacaktır.</p>
                    </div>

                    <div id="gamepass-link-container">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Robux Miktarı (Robux)</label>
                        <input id="withdraw-input" type="number" min="5" step="1" placeholder="Minimum 5 Robux" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">

                        <label class="block text-sm font-medium text-gray-700 mb-1">Robux Gamepass Linki</label>
                        <input id="gamepass-link-input" type="url" placeholder="https://www.roblox.com/game-pass/..." class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                    </div>
                    
                    <p class="text-red-600 text-sm font-semibold mt-2">
                        Not: Çekimlerde %${WITHDRAWAL_COMMISSION_PERCENT} komisyon uygulanacaktır.
                    </p>
                    <button id="confirm-withdraw-btn" class="btn-primary w-full mt-4">
                        Çekim Yap
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Admin Sayfası -->
        <section id="admin-panel" class="app-section hidden">
            <div class="header animated-bg">
                <h1 class="text-2xl font-extrabold pt-4 px-4 mb-4">Admin Paneli</h1>
            </div>
            <div class="main-content space-y-6">
                <div class="card p-5">
                    <h2 class="text-xl font-bold mb-3 text-red-600 flex items-center">
                        <i class="fas fa-bell mr-2"></i>
                        Bekleyen Çekim Talepleri
                    </h2>
                    <ul id="withdrawal-request-list" class="space-y-3">
                        <p class="text-gray-500 text-center p-4">Bekleyen talep yok...</p>
                    </ul>
                </div>
                <p class="text-center text-xs text-gray-400">Sadece adminler görebilir.</p>
            </div>
        </section>

        <!-- Alt Navigasyon Çubuğu -->
        <div class="bottom-nav">
            <button class="nav-btn active" data-page="menu-page">
                <i class="fas fa-home"></i>
                <span>Menü</span>
            </button>
            <button class="nav-btn" data-page="wallet-page">
                <i class="fas fa-wallet"></i>
                <span>Cüzdan</span>
            </button>
            <button class="nav-btn" data-page="withdraw-page">
                <i class="fas fa-money-bill-wave"></i>
                <span>Çekim</span>
            </button>
        </div>

    </div>

</body>
</html>

